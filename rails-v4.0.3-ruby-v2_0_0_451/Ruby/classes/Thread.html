<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Thread</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../css/github.css" type="text/css" media="screen" />
<script src="../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            Thread 
            
                <span class="parent">&lt; 
                    
                    <a href="Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../files/ruby/prelude_rb.html">ruby/prelude.rb</a></li>
            
            <li><a href="../files/ruby/thread_c.html">ruby/thread.c</a></li>
            
            <li><a href="../files/ruby/vm_c.html">ruby/vm.c</a></li>
            
            <li><a href="../files/ruby/vm_trace_c.html">ruby/vm_trace.c</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  
    <div class="description">
      
<p><a href="Thread.html">::Thread</a></p>

    </div>
  


  


  
  


  
    <!-- Namespace -->
    <div class="sectiontitle">Namespace</div>
    <ul>
      
        <li>
          <span class="type">CLASS</span>
          <a href="Thread/Backtrace.html">Thread::Backtrace</a>
        </li>
      
    </ul>
  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>D</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-DEBUG">DEBUG</a>,
              </li>
            
              
              <li>
                <a href="#method-c-DEBUG-3D">DEBUG=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>#</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-5B-5D">[]</a>,
              </li>
            
              
              <li>
                <a href="#method-i-5B-5D-3D">[]=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-abort_on_exception">abort_on_exception</a>,
              </li>
            
              
              <li>
                <a href="#method-i-abort_on_exception">abort_on_exception</a>,
              </li>
            
              
              <li>
                <a href="#method-i-abort_on_exception-3D">abort_on_exception=</a>,
              </li>
            
              
              <li>
                <a href="#method-c-abort_on_exception-3D">abort_on_exception=</a>,
              </li>
            
              
              <li>
                <a href="#method-i-add_trace_func">add_trace_func</a>,
              </li>
            
              
              <li>
                <a href="#method-i-alive-3F">alive?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>B</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-backtrace">backtrace</a>,
              </li>
            
              
              <li>
                <a href="#method-i-backtrace_locations">backtrace_locations</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>C</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-current">current</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>E</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-exclusive">exclusive</a>,
              </li>
            
              
              <li>
                <a href="#method-i-exit">exit</a>,
              </li>
            
              
              <li>
                <a href="#method-c-exit">exit</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>F</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-fork">fork</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>G</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-group">group</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>H</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-handle_interrupt">handle_interrupt</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>I</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-inspect">inspect</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>J</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-join">join</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>K</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-key-3F">key?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-keys">keys</a>,
              </li>
            
              
              <li>
                <a href="#method-c-kill">kill</a>,
              </li>
            
              
              <li>
                <a href="#method-i-kill">kill</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>L</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-list">list</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>M</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-main">main</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>P</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-pass">pass</a>,
              </li>
            
              
              <li>
                <a href="#method-i-pending_interrupt-3F">pending_interrupt?</a>,
              </li>
            
              
              <li>
                <a href="#method-c-pending_interrupt-3F">pending_interrupt?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-priority">priority</a>,
              </li>
            
              
              <li>
                <a href="#method-i-priority-3D">priority=</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-raise">raise</a>,
              </li>
            
              
              <li>
                <a href="#method-i-run">run</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-safe_level">safe_level</a>,
              </li>
            
              
              <li>
                <a href="#method-i-set_trace_func">set_trace_func</a>,
              </li>
            
              
              <li>
                <a href="#method-c-start">start</a>,
              </li>
            
              
              <li>
                <a href="#method-i-status">status</a>,
              </li>
            
              
              <li>
                <a href="#method-c-stop">stop</a>,
              </li>
            
              
              <li>
                <a href="#method-i-stop-3F">stop?</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>T</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-terminate">terminate</a>,
              </li>
            
              
              <li>
                <a href="#method-i-thread_variable-3F">thread_variable?</a>,
              </li>
            
              
              <li>
                <a href="#method-i-thread_variable_get">thread_variable_get</a>,
              </li>
            
              
              <li>
                <a href="#method-i-thread_variable_set">thread_variable_set</a>,
              </li>
            
              
              <li>
                <a href="#method-i-thread_variables">thread_variables</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>V</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-value">value</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>W</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-wakeup">wakeup</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    
      <!-- Section constants -->
      <div class="sectiontitle">Constants</div>
      <table border='0' cellpadding='5'>
        
          <tr valign='top'>
            <td class="attr-name">MUTEX_FOR_THREAD_EXCLUSIVE</td>
            <td>=</td>
            <td class="attr-value">Mutex.new</td>
          </tr>
          
            <tr valign='top'>
              <td>&nbsp;</td>
              <td colspan="2" class="attr-desc"></td>
            </tr>
          
        
      </table>
    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-DEBUG">
            
              <b>Thread.DEBUG     &rarr; num
</b>
            
            <a href="../classes/Thread.html#method-c-DEBUG" name="method-c-DEBUG" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the thread debug level.  Available only if compiled with
THREAD_DEBUG=-1.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-DEBUG_source')" id="l_method-c-DEBUG_source">show</a>
                
              </p>
              <div id="method-c-DEBUG_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_debug(void)
{
    return INT2NUM(rb_thread_debug_enabled);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-DEBUG-3D">
            
              <b>Thread.DEBUG = num
</b>
            
            <a href="../classes/Thread.html#method-c-DEBUG-3D" name="method-c-DEBUG-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets the thread debug level.  Available only if compiled with
THREAD_DEBUG=-1.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-DEBUG-3D_source')" id="l_method-c-DEBUG-3D_source">show</a>
                
              </p>
              <div id="method-c-DEBUG-3D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_debug_set(VALUE self, VALUE val)
{
    rb_thread_debug_enabled = RTEST(val) ? NUM2INT(val) : 0;
    return val;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-abort_on_exception">
            
              <b>Thread.abort_on_exception   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-c-abort_on_exception" name="method-c-abort_on_exception" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the status of the global “abort on exception&#39;&#39; condition. 
The default is <code>false</code>. When set to <code>true</code>, or if the
global <code>$DEBUG</code> flag is <code>true</code> (perhaps because the
command line option <code>-d</code> was specified) all threads will abort
(the process will <code>exit(0)</code>) if an exception is raised in any
thread. See also <code>Thread::abort_on_exception=</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-abort_on_exception_source')" id="l_method-c-abort_on_exception_source">show</a>
                
              </p>
              <div id="method-c-abort_on_exception_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_abort_exc(void)
{
    return GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-abort_on_exception-3D">
            
              <b>Thread.abort_on_exception= boolean   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-c-abort_on_exception-3D" name="method-c-abort_on_exception-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>When set to <code>true</code>, all threads will abort if an exception is
raised. Returns the new state.</p>

<pre><code>Thread.abort_on_exception = true
t1 = Thread.new do
  puts  &quot;In new thread&quot;
  raise &quot;Exception from thread&quot;
end
sleep(1)
puts &quot;not reached&quot;</code></pre>

<p><em>produces:</em></p>

<pre><code>In new thread
prog.rb:4: Exception from thread (RuntimeError)
 from prog.rb:2:in `initialize&#39;
 from prog.rb:2:in `new&#39;
 from prog.rb:2</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-abort_on_exception-3D_source')" id="l_method-c-abort_on_exception-3D_source">show</a>
                
              </p>
              <div id="method-c-abort_on_exception-3D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_abort_exc_set(VALUE self, VALUE val)
{
    rb_secure(4);
    GET_THREAD()-&gt;vm-&gt;thread_abort_on_exception = RTEST(val);
    return val;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-current">
            
              <b>Thread.current   &rarr; thread
</b>
            
            <a href="../classes/Thread.html#method-c-current" name="method-c-current" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the currently executing thread.</p>

<pre><code>Thread.current   #=&gt; #&lt;Thread:0x401bdf4c run&gt;
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-current_source')" id="l_method-c-current_source">show</a>
                
              </p>
              <div id="method-c-current_source" class="dyn-source">
                <pre>static VALUE
thread_s_current(VALUE klass)
{
    return rb_thread_current();
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-exclusive">
            
              <b>Thread.exclusive { block }   => obj
</b>
            
            <a href="../classes/Thread.html#method-c-exclusive" name="method-c-exclusive" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Wraps a block in Thread.critical, restoring the original value upon exit
from the critical section, and returns the value of the block.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-exclusive_source')" id="l_method-c-exclusive_source">show</a>
                
              </p>
              <div id="method-c-exclusive_source" class="dyn-source">
                <pre><span class="ruby-comment"># File ruby/prelude.rb, line 10</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">self</span>.<span class="ruby-identifier">exclusive</span>
  <span class="ruby-constant">MUTEX_FOR_THREAD_EXCLUSIVE</span>.<span class="ruby-identifier">synchronize</span>{
    <span class="ruby-keyword">yield</span>
  }
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-exit">
            
              <b>Thread.exit   &rarr; thread</b>
            
            <a href="../classes/Thread.html#method-c-exit" name="method-c-exit" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Terminates the currently running thread and schedules another thread to be
run. If this thread is already marked to be killed, <code>exit</code>
returns the <code>Thread</code>. If this is the main thread, or the last
thread, exit the process.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-exit_source')" id="l_method-c-exit_source">show</a>
                
              </p>
              <div id="method-c-exit_source" class="dyn-source">
                <pre>static VALUE
rb_thread_exit(void)
{
    rb_thread_t *th = GET_THREAD();
    return rb_thread_kill(th-&gt;self);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-fork">
            
              <b>Thread.fork([args]*) {|args| block }    &rarr; thread</b>
            
            <a href="../classes/Thread.html#method-c-fork" name="method-c-fork" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Basically the same as <a href="Thread.html#method-c-new">::new</a>.
However, if class <a href="Thread.html">Thread</a> is subclassed, then
calling <code>start</code> in that subclass will not invoke the
subclass&#39;s <code>initialize</code> method.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-fork_source')" id="l_method-c-fork_source">show</a>
                
              </p>
              <div id="method-c-fork_source" class="dyn-source">
                <pre>static VALUE
thread_start(VALUE klass, VALUE args)
{
    return thread_create_core(rb_thread_alloc(klass), args, 0);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-handle_interrupt">
            
              <b>Thread.handle_interrupt(hash) { ... } &rarr; result of the block
</b>
            
            <a href="../classes/Thread.html#method-c-handle_interrupt" name="method-c-handle_interrupt" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Changes asynchronous interrupt timing.</p>

<p><em>interrupt</em> means asynchronous event and corresponding procedure by
<a href="Thread.html#method-i-raise">#raise</a>, <a
href="Thread.html#method-i-kill">#kill</a>, signal trap (not supported yet)
and main thread termination (if main thread terminates, then all other
thread will be killed).</p>

<p>The given <code>hash</code> has pairs like <code>ExceptionClass =&gt;
:TimingSymbol</code>. Where the ExceptionClass is the interrupt handled by
the given block. The TimingSymbol can be one of the following symbols:</p>
<dl class="rdoc-list label-list"><dt><code>:immediate</code>
<dd>
<p>Invoke interrupts immediately.</p>
</dd><dt><code>:on_blocking</code>
<dd>
<p>Invoke interrupts while <em>BlockingOperation</em>.</p>
</dd><dt><code>:never</code>
<dd>
<p>Never invoke all interrupts.</p>
</dd></dl>

<p><em>BlockingOperation</em> means that the operation will block the calling
thread, such as read and write.  On CRuby implementation,
<em>BlockingOperation</em> is any operation executed without GVL.</p>

<p>Masked asynchronous interrupts are delayed until they are enabled. This
method is similar to sigprocmask(3).</p>

<h3 id="method-c-handle_interrupt-label-NOTE">NOTE</h3>

<p>Asynchronous interrupts are difficult to use.</p>

<p>If you need to communicate between threads, please consider to use another
way such as <a href="Queue.html">Queue</a>.</p>

<p>Or use them with deep understanding about this method.</p>

<h3 id="method-c-handle_interrupt-label-Usage">Usage</h3>

<p>In this example, we can guard from <a
href="Thread.html#method-i-raise">#raise</a> exceptions.</p>

<p>Using the <code>:never</code> TimingSymbol the <a
href="RuntimeError.html">RuntimeError</a> exception will always be ignored
in the first block of the main thread. In the second <a
href="Thread.html#method-c-handle_interrupt">::handle_interrupt</a> block
we can purposefully handle <a href="RuntimeError.html">RuntimeError</a>
exceptions.</p>

<pre><code>th = Thread.new do
  Thead.handle_interrupt(RuntimeError =&gt; :never) {
    begin
      # You can write resource allocation code safely.
      Thread.handle_interrupt(RuntimeError =&gt; :immediate) {
        # ...
      }
    ensure
      # You can write resource deallocation code safely.
    end
  }
end
Thread.pass
# ...
th.raise &quot;stop&quot;
</code></pre>

<p>While we are ignoring the <a href="RuntimeError.html">RuntimeError</a>
exception, it&#39;s safe to write our resource allocation code. Then, the
ensure block is where we can safely deallocate your resources.</p>

<h4 id="method-c-handle_interrupt-label-Guarding+from+TimeoutError">Guarding from <a href="Timeout/TimeoutError.html">TimeoutError</a></h4>

<p>In the next example, we will guard from the <a
href="Timeout/TimeoutError.html">TimeoutError</a> exception. This will help
prevent from leaking resources when <a
href="Timeout/TimeoutError.html">TimeoutError</a> exceptions occur during
normal ensure clause. For this example we use the help of the standard
library <a href="Timeout.html">Timeout</a>, from lib/timeout.rb</p>

<pre><code>require &#39;timeout&#39;
Thread.handle_interrupt(TimeoutError =&gt; :never) {
  timeout(10){
    # TimeoutError doesn&#39;t occur here
    Thread.handle_interrupt(TimeoutError =&gt; :on_blocking) {
      # possible to be killed by TimeoutError
      # while blocking operation
    }
    # TimeoutError doesn&#39;t occur here
  }
}
</code></pre>

<p>In the first part of the <code>timeout</code> block, we can rely on <a
href="Timeout/TimeoutError.html">TimeoutError</a> being ignored. Then in
the <code>TimeoutError =&gt; :on_blocking</code> block, any operation that
will block the calling thread is susceptible to a <a
href="Timeout/TimeoutError.html">TimeoutError</a> exception being raised.</p>

<h4 id="method-c-handle_interrupt-label-Stack+control+settings">Stack control settings</h4>

<p>It&#39;s possible to stack multiple levels of <a
href="Thread.html#method-c-handle_interrupt">::handle_interrupt</a> blocks
in order to control more than one ExceptionClass and TimingSymbol at a
time.</p>

<pre><code>Thread.handle_interrupt(FooError =&gt; :never) {
  Thread.handle_interrupt(BarError =&gt; :never) {
     # FooError and BarError are prohibited.
  }
}
</code></pre>

<h4 id="method-c-handle_interrupt-label-Inheritance+with+ExceptionClass">Inheritance with ExceptionClass</h4>

<p>All exceptions inherited from the ExceptionClass parameter will be
considered.</p>

<pre><code>Thread.handle_interrupt(Exception =&gt; :never) {
  # all exceptions inherited from Exception are prohibited.
}
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-handle_interrupt_source')" id="l_method-c-handle_interrupt_source">show</a>
                
              </p>
              <div id="method-c-handle_interrupt_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_handle_interrupt(VALUE self, VALUE mask_arg)
{
    VALUE mask;
    rb_thread_t *th = GET_THREAD();
    VALUE r = Qnil;
    int state;

    if (!rb_block_given_p()) {
        rb_raise(rb_eArgError, &quot;block is needed.&quot;);
    }

    mask = rb_convert_type(mask_arg, T_HASH, &quot;Hash&quot;, &quot;to_hash&quot;);
    rb_hash_foreach(mask, handle_interrupt_arg_check_i, 0);
    rb_ary_push(th-&gt;pending_interrupt_mask_stack, mask);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
        th-&gt;pending_interrupt_queue_checked = 0;
        RUBY_VM_SET_INTERRUPT(th);
    }

    TH_PUSH_TAG(th);
    if ((state = EXEC_TAG()) == 0) {
        r = rb_yield(Qnil);
    }
    TH_POP_TAG();

    rb_ary_pop(th-&gt;pending_interrupt_mask_stack);
    if (!rb_threadptr_pending_interrupt_empty_p(th)) {
        th-&gt;pending_interrupt_queue_checked = 0;
        RUBY_VM_SET_INTERRUPT(th);
    }

    RUBY_VM_CHECK_INTS(th);

    if (state) {
        JUMP_TAG(state);
    }

    return r;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-kill">
            
              <b>Thread.kill(thread)   &rarr; thread</b>
            
            <a href="../classes/Thread.html#method-c-kill" name="method-c-kill" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Causes the given <em>thread</em> to exit (see <code>Thread::exit</code>).</p>

<pre><code>count = 0
a = Thread.new { loop { count += 1 } }
sleep(0.1)       #=&gt; 0
Thread.kill(a)   #=&gt; #&lt;Thread:0x401b3d30 dead&gt;
count            #=&gt; 93947
a.alive?         #=&gt; false
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-kill_source')" id="l_method-c-kill_source">show</a>
                
              </p>
              <div id="method-c-kill_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_kill(VALUE obj, VALUE th)
{
    return rb_thread_kill(th);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-list">
            
              <b>Thread.list   &rarr; array
</b>
            
            <a href="../classes/Thread.html#method-c-list" name="method-c-list" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns an array of <code>Thread</code> objects for all threads that are
either runnable or stopped.</p>

<pre><code>Thread.new { sleep(200) }
Thread.new { 1000000.times {|i| i*i } }
Thread.new { Thread.stop }
Thread.list.each {|t| p t}
</code></pre>

<p><em>produces:</em></p>

<pre><code>#&lt;Thread:0x401b3e84 sleep&gt;
#&lt;Thread:0x401b3f38 run&gt;
#&lt;Thread:0x401b3fb0 sleep&gt;
#&lt;Thread:0x401bdf4c run&gt;</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-list_source')" id="l_method-c-list_source">show</a>
                
              </p>
              <div id="method-c-list_source" class="dyn-source">
                <pre>VALUE
rb_thread_list(void)
{
    VALUE ary = rb_ary_new();
    st_foreach(GET_THREAD()-&gt;vm-&gt;living_threads, thread_list_i, ary);
    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-main">
            
              <b>Thread.main   &rarr; thread
</b>
            
            <a href="../classes/Thread.html#method-c-main" name="method-c-main" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the main thread.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-main_source')" id="l_method-c-main_source">show</a>
                
              </p>
              <div id="method-c-main_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_main(VALUE klass)
{
    return rb_thread_main();
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>Thread.new { ... }                  &rarr; thread
Thread.new(*args, &proc)            &rarr; thread
Thread.new(*args) { |args| ... }    &rarr; thread
</b>
            
            <a href="../classes/Thread.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Creates a new thread executing the given block.</p>

<p>Any <code>args</code> given to <a href="Thread.html#method-c-new">::new</a>
will be passed to the block:</p>

<pre><code>arr = []
a, b, c = 1, 2, 3
Thread.new(a,b,c) { |d,e,f| arr &lt;&lt; d &lt;&lt; e &lt;&lt; f }.join
arr #=&gt; [1, 2, 3]
</code></pre>

<p>A <a href="ThreadError.html">ThreadError</a> exception is raised if <a
href="Thread.html#method-c-new">::new</a> is called without a block.</p>

<p>If you&#39;re going to subclass <a href="Thread.html">Thread</a>, be sure
to call super in your <code>initialize</code> method, otherwise a <a
href="ThreadError.html">ThreadError</a> will be raised.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre>static VALUE
thread_s_new(int argc, VALUE *argv, VALUE klass)
{
    rb_thread_t *th;
    VALUE thread = rb_thread_alloc(klass);

    if (GET_VM()-&gt;main_thread-&gt;status == THREAD_KILLED)
        rb_raise(rb_eThreadError, &quot;can&#39;t alloc thread&quot;);

    rb_obj_call_init(thread, argc, argv);
    GetThreadPtr(thread, th);
    if (!th-&gt;first_args) {
        rb_raise(rb_eThreadError, &quot;uninitialized thread - check `%s#initialize&#39;&quot;,
                 rb_class2name(klass));
    }
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-pass">
            
              <b>Thread.pass   &rarr; nil
</b>
            
            <a href="../classes/Thread.html#method-c-pass" name="method-c-pass" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Give the thread scheduler a hint to pass execution to another thread. A
running thread may or may not switch, it depends on OS and processor.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-pass_source')" id="l_method-c-pass_source">show</a>
                
              </p>
              <div id="method-c-pass_source" class="dyn-source">
                <pre>static VALUE
thread_s_pass(VALUE klass)
{
    rb_thread_schedule();
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-pending_interrupt-3F">
            
              <b>Thread.pending_interrupt?(error = nil) &rarr; true/false
</b>
            
            <a href="../classes/Thread.html#method-c-pending_interrupt-3F" name="method-c-pending_interrupt-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns whether or not the asynchronous queue is empty.</p>

<p>Since <a
href="Thread.html#method-c-handle_interrupt">::handle_interrupt</a> can be
used to defer asynchronous events. This method can be used to determine if
there are any deferred events.</p>

<p>If you find this method returns true, then you may finish
<code>:never</code> blocks.</p>

<p>For example, the following method processes deferred asynchronous events
immediately.</p>

<pre><code>def Thread.kick_interrupt_immediately
  Thread.handle_interrupt(Object =&gt; :immediate) {
    Thread.pass
  }
end
</code></pre>

<p>If <code>error</code> is given, then check only for <code>error</code> type
deferred events.</p>

<h3 id="method-c-pending_interrupt-3F-label-Usage">Usage</h3>

<pre><code>th = Thread.new{
  Thread.handle_interrupt(RuntimeError =&gt; :on_blocking){
    while true
      ...
      # reach safe point to invoke interrupt
      if Thread.pending_interrupt?
        Thread.handle_interrupt(Object =&gt; :immediate){}
      end
      ...
    end
  }
}
...
th.raise # stop thread
</code></pre>

<p>This example can also be written as the following, which you should use to
avoid asynchronous interrupts.</p>

<pre><code>flag = true
th = Thread.new{
  Thread.handle_interrupt(RuntimeError =&gt; :on_blocking){
    while true
      ...
      # reach safe point to invoke interrupt
      break if flag == false
      ...
    end
  }
}
...
flag = false # stop thread
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-pending_interrupt-3F_source')" id="l_method-c-pending_interrupt-3F_source">show</a>
                
              </p>
              <div id="method-c-pending_interrupt-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_s_pending_interrupt_p(int argc, VALUE *argv, VALUE self)
{
    return rb_thread_pending_interrupt_p(argc, argv, GET_THREAD()-&gt;self);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-start">
            
              <b>Thread.start([args]*) {|args| block }   &rarr; thread</b>
            
            <a href="../classes/Thread.html#method-c-start" name="method-c-start" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Basically the same as <a href="Thread.html#method-c-new">::new</a>.
However, if class <a href="Thread.html">Thread</a> is subclassed, then
calling <code>start</code> in that subclass will not invoke the
subclass&#39;s <code>initialize</code> method.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-start_source')" id="l_method-c-start_source">show</a>
                
              </p>
              <div id="method-c-start_source" class="dyn-source">
                <pre>static VALUE
thread_start(VALUE klass, VALUE args)
{
    return thread_create_core(rb_thread_alloc(klass), args, 0);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-c-stop">
            
              <b>Thread.stop   &rarr; nil
</b>
            
            <a href="../classes/Thread.html#method-c-stop" name="method-c-stop" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Stops execution of the current thread, putting it into a “sleep&#39;&#39;
state, and schedules execution of another thread.</p>

<pre><code>a = Thread.new { print &quot;a&quot;; Thread.stop; print &quot;c&quot; }
sleep 0.1 while a.status!=&#39;sleep&#39;
print &quot;b&quot;
a.run
a.join</code></pre>

<p><em>produces:</em></p>

<pre><code>abc</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-stop_source')" id="l_method-c-stop_source">show</a>
                
              </p>
              <div id="method-c-stop_source" class="dyn-source">
                <pre>VALUE
rb_thread_stop(void)
{
    if (rb_thread_alone()) {
        rb_raise(rb_eThreadError,
                 &quot;stopping only thread\n\tnote: use sleep to stop forever&quot;);
    }
    rb_thread_sleep_deadly();
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-5B-5D">
            
              <b>thr[sym]   &rarr; obj or nil
</b>
            
            <a href="../classes/Thread.html#method-i-5B-5D" name="method-i-5B-5D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Attribute Reference—Returns the value of a fiber-local variable (current
thread&#39;s root fiber if not explicitely inside a <a
href="Fiber.html">Fiber</a>), using either a symbol or a string name. If
the specified variable does not exist, returns <code>nil</code>.</p>

<pre><code>[
  Thread.new { Thread.current[&quot;name&quot;] = &quot;A&quot; },
  Thread.new { Thread.current[:name]  = &quot;B&quot; },
  Thread.new { Thread.current[&quot;name&quot;] = &quot;C&quot; }
].each do |th|
  th.join
  puts &quot;#{th.inspect}: #{th[:name]}&quot;
end
</code></pre>

<p><em>produces:</em></p>

<pre><code>#&lt;Thread:0x00000002a54220 dead&gt;: A
#&lt;Thread:0x00000002a541a8 dead&gt;: B
#&lt;Thread:0x00000002a54130 dead&gt;: C</code></pre>

<p><a href="Thread.html#method-i-5B-5D">#[]</a> and <a
href="Thread.html#method-i-5B-5D-3D">#[]=</a> are not thread-local but
fiber-local. This confusion did not exist in Ruby 1.8 because fibers were
only available since Ruby 1.9. Ruby 1.9 chooses that the methods behaves
fiber-local to save following idiom for dynamic scope.</p>

<pre><code>def meth(newvalue)
  begin
    oldvalue = Thread.current[:name]
    Thread.current[:name] = newvalue
    yield
  ensure
    Thread.current[:name] = oldvalue
  end
end
</code></pre>

<p>The idiom may not work as dynamic scope if the methods are thread-local and
a given block switches fiber.</p>

<pre><code>f = Fiber.new {
  meth(1) {
    Fiber.yield
  }
}
meth(2) {
  f.resume
}
f.resume
p Thread.current[:name]
#=&gt; nil if fiber-local
#=&gt; 2 if thread-local (The value 2 is leaked to outside of meth method.)
</code></pre>

<p>For thread-local variables, please see <code>Thread#thread_local_get</code>
and <code>Thread#thread_local_set</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-5B-5D_source')" id="l_method-i-5B-5D_source">show</a>
                
              </p>
              <div id="method-i-5B-5D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_aref(VALUE thread, VALUE id)
{
    return rb_thread_local_aref(thread, rb_to_id(id));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-5B-5D-3D">
            
              <b>thr[sym] = obj   &rarr; obj
</b>
            
            <a href="../classes/Thread.html#method-i-5B-5D-3D" name="method-i-5B-5D-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Attribute Assignment—Sets or creates the value of a fiber-local variable,
using either a symbol or a string. See also <code>Thread#[]</code>.  For
thread-local variables, please see <code>Thread#thread_variable_set</code>
and <code>Thread#thread_variable_get</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-5B-5D-3D_source')" id="l_method-i-5B-5D-3D_source">show</a>
                
              </p>
              <div id="method-i-5B-5D-3D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_aset(VALUE self, VALUE id, VALUE val)
{
    return rb_thread_local_aset(self, rb_to_id(id), val);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-abort_on_exception">
            
              <b>thr.abort_on_exception   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-abort_on_exception" name="method-i-abort_on_exception" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the status of the thread-local “abort on exception&#39;&#39;
condition for <em>thr</em>. The default is <code>false</code>. See also
<code>Thread::abort_on_exception=</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-abort_on_exception_source')" id="l_method-i-abort_on_exception_source">show</a>
                
              </p>
              <div id="method-i-abort_on_exception_source" class="dyn-source">
                <pre>static VALUE
rb_thread_abort_exc(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return th-&gt;abort_on_exception ? Qtrue : Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-abort_on_exception-3D">
            
              <b>thr.abort_on_exception= boolean   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-abort_on_exception-3D" name="method-i-abort_on_exception-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>When set to <code>true</code>, causes all threads (including the main
program) to abort if an exception is raised in <em>thr</em>. The process
will effectively <code>exit(0)</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-abort_on_exception-3D_source')" id="l_method-i-abort_on_exception-3D_source">show</a>
                
              </p>
              <div id="method-i-abort_on_exception-3D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_abort_exc_set(VALUE thread, VALUE val)
{
    rb_thread_t *th;
    rb_secure(4);

    GetThreadPtr(thread, th);
    th-&gt;abort_on_exception = RTEST(val);
    return val;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-add_trace_func">
            
              <b>thr.add_trace_func(proc)    &rarr; proc
</b>
            
            <a href="../classes/Thread.html#method-i-add_trace_func" name="method-i-add_trace_func" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Adds <em>proc</em> as a handler for tracing. See
<code>Thread#set_trace_func</code> and <code>set_trace_func</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-add_trace_func_source')" id="l_method-i-add_trace_func_source">show</a>
                
              </p>
              <div id="method-i-add_trace_func_source" class="dyn-source">
                <pre>static VALUE
thread_add_trace_func_m(VALUE obj, VALUE trace)
{
    rb_thread_t *th;

    rb_secure(4);
    GetThreadPtr(obj, th);
    thread_add_trace_func(th, trace);
    return trace;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-alive-3F">
            
              <b>thr.alive?   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-alive-3F" name="method-i-alive-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns <code>true</code> if <em>thr</em> is running or sleeping.</p>

<pre><code>thr = Thread.new { }
thr.join                #=&gt; #&lt;Thread:0x401b3fb0 dead&gt;
Thread.current.alive?   #=&gt; true
thr.alive?              #=&gt; false
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-alive-3F_source')" id="l_method-i-alive-3F_source">show</a>
                
              </p>
              <div id="method-i-alive-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_alive_p(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th))
        return Qfalse;
    return Qtrue;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-backtrace">
            
              <b>thr.backtrace     &rarr; array
</b>
            
            <a href="../classes/Thread.html#method-i-backtrace" name="method-i-backtrace" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the current backtrace of the target thread.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-backtrace_source')" id="l_method-i-backtrace_source">show</a>
                
              </p>
              <div id="method-i-backtrace_source" class="dyn-source">
                <pre>static VALUE
rb_thread_backtrace_m(int argc, VALUE *argv, VALUE thval)
{
    return vm_thread_backtrace(argc, argv, thval);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-backtrace_locations">
            
              <b>thr.backtrace_locations(*args)      &rarr; array or nil
</b>
            
            <a href="../classes/Thread.html#method-i-backtrace_locations" name="method-i-backtrace_locations" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the execution stack for the target thread—an array containing
backtrace location objects.</p>

<p>See <a
href="Thread/Backtrace/Location.html">Thread::Backtrace::Location</a> for
more information.</p>

<p>This method behaves similarly to <a
href="Kernel.html#method-i-caller_locations">Kernel#caller_locations</a>
except it applies to a specific thread.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-backtrace_locations_source')" id="l_method-i-backtrace_locations_source">show</a>
                
              </p>
              <div id="method-i-backtrace_locations_source" class="dyn-source">
                <pre>static VALUE
rb_thread_backtrace_locations_m(int argc, VALUE *argv, VALUE thval)
{
    return vm_thread_backtrace_locations(argc, argv, thval);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-exit">
            
              <b>thr.exit        &rarr; thr or nil
thr.kill        &rarr; thr or nil
thr.terminate   &rarr; thr or nil
</b>
            
            <a href="../classes/Thread.html#method-i-exit" name="method-i-exit" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Terminates <em>thr</em> and schedules another thread to be run. If this
thread is already marked to be killed, <code>exit</code> returns the
<code>Thread</code>. If this is the main thread, or the last thread, exits
the process.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-exit_source')" id="l_method-i-exit_source">show</a>
                
              </p>
              <div id="method-i-exit_source" class="dyn-source">
                <pre>VALUE
rb_thread_kill(VALUE thread)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (th != GET_THREAD() &amp;&amp; th-&gt;safe_level &lt; 4) {
        rb_secure(4);
    }
    if (th-&gt;to_kill || th-&gt;status == THREAD_KILLED) {
        return thread;
    }
    if (th == th-&gt;vm-&gt;main_thread) {
        rb_exit(EXIT_SUCCESS);
    }

    thread_debug(&quot;rb_thread_kill: %p (%p)\n&quot;, (void *)th, (void *)th-&gt;thread_id);

    if (th == GET_THREAD()) {
        /* kill myself immediately */
        rb_threadptr_to_kill(th);
    }
    else {
        rb_threadptr_pending_interrupt_enque(th, eKillSignal);
        rb_threadptr_interrupt(th);
    }
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-group">
            
              <b>thr.group   &rarr; thgrp or nil
</b>
            
            <a href="../classes/Thread.html#method-i-group" name="method-i-group" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the <code>ThreadGroup</code> which contains <em>thr</em>, or nil if
the thread is not a member of any group.</p>

<pre><code>Thread.main.group   #=&gt; #&lt;ThreadGroup:0x4029d914&gt;
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-group_source')" id="l_method-i-group_source">show</a>
                
              </p>
              <div id="method-i-group_source" class="dyn-source">
                <pre>VALUE
rb_thread_group(VALUE thread)
{
    rb_thread_t *th;
    VALUE group;
    GetThreadPtr(thread, th);
    group = th-&gt;thgroup;

    if (!group) {
        group = Qnil;
    }
    return group;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-inspect">
            
              <b>thr.inspect   &rarr; string
</b>
            
            <a href="../classes/Thread.html#method-i-inspect" name="method-i-inspect" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Dump the name, id, and status of <em>thr</em> to a string.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-inspect_source')" id="l_method-i-inspect_source">show</a>
                
              </p>
              <div id="method-i-inspect_source" class="dyn-source">
                <pre>static VALUE
rb_thread_inspect(VALUE thread)
{
    const char *cname = rb_obj_classname(thread);
    rb_thread_t *th;
    const char *status;
    VALUE str;

    GetThreadPtr(thread, th);
    status = thread_status_name(th);
    str = rb_sprintf(&quot;#&lt;%s:%p %s&gt;&quot;, cname, (void *)thread, status);
    OBJ_INFECT(str, thread);

    return str;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-join">
            
              <b>thr.join          &rarr; thr
thr.join(limit)   &rarr; thr
</b>
            
            <a href="../classes/Thread.html#method-i-join" name="method-i-join" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>The calling thread will suspend execution and run <em>thr</em>. Does not
return until <em>thr</em> exits or until <em>limit</em> seconds have
passed. If the time limit expires, <code>nil</code> will be returned,
otherwise <em>thr</em> is returned.</p>

<p>Any threads not joined will be killed when the main program exits.  If
<em>thr</em> had previously raised an exception and the
<code>abort_on_exception</code> and <code>$DEBUG</code> flags are not set
(so the exception has not yet been processed) it will be processed at this
time.</p>

<pre><code>a = Thread.new { print &quot;a&quot;; sleep(10); print &quot;b&quot;; print &quot;c&quot; }
x = Thread.new { print &quot;x&quot;; Thread.pass; print &quot;y&quot;; print &quot;z&quot; }
x.join # Let x thread finish, a will be killed on exit.</code></pre>

<p><em>produces:</em></p>

<pre><code>axyz</code></pre>

<p>The following example illustrates the <em>limit</em> parameter.</p>

<pre><code>y = Thread.new { 4.times { sleep 0.1; puts &#39;tick... &#39; }}
puts &quot;Waiting&quot; until y.join(0.15)</code></pre>

<p><em>produces:</em></p>

<pre><code>tick...
Waiting
tick...
Waitingtick...

tick...</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-join_source')" id="l_method-i-join_source">show</a>
                
              </p>
              <div id="method-i-join_source" class="dyn-source">
                <pre>static VALUE
thread_join_m(int argc, VALUE *argv, VALUE self)
{
    rb_thread_t *target_th;
    double delay = DELAY_INFTY;
    VALUE limit;

    GetThreadPtr(self, target_th);

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;limit);
    if (!NIL_P(limit)) {
        delay = rb_num2dbl(limit);
    }

    return thread_join(target_th, delay);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-key-3F">
            
              <b>thr.key?(sym)   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-key-3F" name="method-i-key-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns <code>true</code> if the given string (or symbol) exists as a
fiber-local variable.</p>

<pre><code>me = Thread.current
me[:oliver] = &quot;a&quot;
me.key?(:oliver)    #=&gt; true
me.key?(:stanley)   #=&gt; false
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-key-3F_source')" id="l_method-i-key-3F_source">show</a>
                
              </p>
              <div id="method-i-key-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_key_p(VALUE self, VALUE key)
{
    rb_thread_t *th;
    ID id = rb_to_id(key);

    GetThreadPtr(self, th);

    if (!th-&gt;local_storage) {
        return Qfalse;
    }
    if (st_lookup(th-&gt;local_storage, id, 0)) {
        return Qtrue;
    }
    return Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-keys">
            
              <b>thr.keys   &rarr; array
</b>
            
            <a href="../classes/Thread.html#method-i-keys" name="method-i-keys" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns an an array of the names of the fiber-local variables (as Symbols).</p>

<pre><code>thr = Thread.new do
  Thread.current[:cat] = &#39;meow&#39;
  Thread.current[&quot;dog&quot;] = &#39;woof&#39;
end
thr.join   #=&gt; #&lt;Thread:0x401b3f10 dead&gt;
thr.keys   #=&gt; [:dog, :cat]
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-keys_source')" id="l_method-i-keys_source">show</a>
                
              </p>
              <div id="method-i-keys_source" class="dyn-source">
                <pre>static VALUE
rb_thread_keys(VALUE self)
{
    rb_thread_t *th;
    VALUE ary = rb_ary_new();
    GetThreadPtr(self, th);

    if (th-&gt;local_storage) {
        st_foreach(th-&gt;local_storage, thread_keys_i, ary);
    }
    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-kill">
            
              <b>thr.exit        &rarr; thr or nil
thr.kill        &rarr; thr or nil
thr.terminate   &rarr; thr or nil
</b>
            
            <a href="../classes/Thread.html#method-i-kill" name="method-i-kill" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Terminates <em>thr</em> and schedules another thread to be run. If this
thread is already marked to be killed, <code>exit</code> returns the
<code>Thread</code>. If this is the main thread, or the last thread, exits
the process.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-kill_source')" id="l_method-i-kill_source">show</a>
                
              </p>
              <div id="method-i-kill_source" class="dyn-source">
                <pre>VALUE
rb_thread_kill(VALUE thread)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (th != GET_THREAD() &amp;&amp; th-&gt;safe_level &lt; 4) {
        rb_secure(4);
    }
    if (th-&gt;to_kill || th-&gt;status == THREAD_KILLED) {
        return thread;
    }
    if (th == th-&gt;vm-&gt;main_thread) {
        rb_exit(EXIT_SUCCESS);
    }

    thread_debug(&quot;rb_thread_kill: %p (%p)\n&quot;, (void *)th, (void *)th-&gt;thread_id);

    if (th == GET_THREAD()) {
        /* kill myself immediately */
        rb_threadptr_to_kill(th);
    }
    else {
        rb_threadptr_pending_interrupt_enque(th, eKillSignal);
        rb_threadptr_interrupt(th);
    }
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-pending_interrupt-3F">
            
              <b>target_thread.pending_interrupt?(error = nil) &rarr; true/false
</b>
            
            <a href="../classes/Thread.html#method-i-pending_interrupt-3F" name="method-i-pending_interrupt-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns whether or not the asychronous queue is empty for the target
thread.</p>

<p>If <code>error</code> is given, then check only for <code>error</code> type
deferred events.</p>

<p>See <a
href="Thread.html#method-c-pending_interrupt-3F">::pending_interrupt?</a>
for more information.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-pending_interrupt-3F_source')" id="l_method-i-pending_interrupt-3F_source">show</a>
                
              </p>
              <div id="method-i-pending_interrupt-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_pending_interrupt_p(int argc, VALUE *argv, VALUE target_thread)
{
    rb_thread_t *target_th;

    GetThreadPtr(target_thread, target_th);

    if (rb_threadptr_pending_interrupt_empty_p(target_th)) {
        return Qfalse;
    }
    else {
        if (argc == 1) {
            VALUE err;
            rb_scan_args(argc, argv, &quot;01&quot;, &amp;err);
            if (!rb_obj_is_kind_of(err, rb_cModule)) {
                rb_raise(rb_eTypeError, &quot;class or module required for rescue clause&quot;);
            }
            if (rb_threadptr_pending_interrupt_include_p(target_th, err)) {
                return Qtrue;
            }
            else {
                return Qfalse;
            }
        }
        return Qtrue;
    }
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-priority">
            
              <b>thr.priority   &rarr; integer
</b>
            
            <a href="../classes/Thread.html#method-i-priority" name="method-i-priority" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the priority of <em>thr</em>. Default is inherited from the current
thread which creating the new thread, or zero for the initial main thread;
higher-priority thread will run more frequently than lower-priority threads
(but lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some
platform.</p>

<pre><code>Thread.current.priority   #=&gt; 0
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-priority_source')" id="l_method-i-priority_source">show</a>
                
              </p>
              <div id="method-i-priority_source" class="dyn-source">
                <pre>static VALUE
rb_thread_priority(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);
    return INT2NUM(th-&gt;priority);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-priority-3D">
            
              <b>thr.priority= integer   &rarr; thr
</b>
            
            <a href="../classes/Thread.html#method-i-priority-3D" name="method-i-priority-3D" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets the priority of <em>thr</em> to <em>integer</em>. Higher-priority
threads will run more frequently than lower-priority threads (but
lower-priority threads can also run).</p>

<p>This is just hint for Ruby thread scheduler.  It may be ignored on some
platform.</p>

<pre><code>count1 = count2 = 0
a = Thread.new do
      loop { count1 += 1 }
    end
a.priority = -1

b = Thread.new do
      loop { count2 += 1 }
    end
b.priority = -2
sleep 1   #=&gt; 1
count1    #=&gt; 622504
count2    #=&gt; 5832
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-priority-3D_source')" id="l_method-i-priority-3D_source">show</a>
                
              </p>
              <div id="method-i-priority-3D_source" class="dyn-source">
                <pre>static VALUE
rb_thread_priority_set(VALUE thread, VALUE prio)
{
    rb_thread_t *th;
    int priority;
    GetThreadPtr(thread, th);

    rb_secure(4);

#if USE_NATIVE_THREAD_PRIORITY
    th-&gt;priority = NUM2INT(prio);
    native_thread_apply_priority(th);
#else
    priority = NUM2INT(prio);
    if (priority &gt; RUBY_THREAD_PRIORITY_MAX) {
        priority = RUBY_THREAD_PRIORITY_MAX;
    }
    else if (priority &lt; RUBY_THREAD_PRIORITY_MIN) {
        priority = RUBY_THREAD_PRIORITY_MIN;
    }
    th-&gt;priority = priority;
#endif
    return INT2NUM(th-&gt;priority);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-raise">
            
              <b>thr.raise
thr.raise(string)
thr.raise(exception [, string [, array]])
</b>
            
            <a href="../classes/Thread.html#method-i-raise" name="method-i-raise" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Raises an exception (see <code>Kernel::raise</code>) from <em>thr</em>. The
caller does not have to be <em>thr</em>.</p>

<pre><code>Thread.abort_on_exception = true
a = Thread.new { sleep(200) }
a.raise(&quot;Gotcha&quot;)</code></pre>

<p><em>produces:</em></p>

<pre><code>prog.rb:3: Gotcha (RuntimeError)
 from prog.rb:2:in `initialize&#39;
 from prog.rb:2:in `new&#39;
 from prog.rb:2</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-raise_source')" id="l_method-i-raise_source">show</a>
                
              </p>
              <div id="method-i-raise_source" class="dyn-source">
                <pre>static VALUE
thread_raise_m(int argc, VALUE *argv, VALUE self)
{
    rb_thread_t *target_th;
    rb_thread_t *th = GET_THREAD();
    GetThreadPtr(self, target_th);
    rb_threadptr_raise(target_th, argc, argv);

    /* To perform Thread.current.raise as Kernel.raise */
    if (th == target_th) {
        RUBY_VM_CHECK_INTS(th);
    }
    return Qnil;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-run">
            
              <b>thr.run   &rarr; thr
</b>
            
            <a href="../classes/Thread.html#method-i-run" name="method-i-run" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Wakes up <em>thr</em>, making it eligible for scheduling.</p>

<pre><code>a = Thread.new { puts &quot;a&quot;; Thread.stop; puts &quot;c&quot; }
sleep 0.1 while a.status!=&#39;sleep&#39;
puts &quot;Got here&quot;
a.run
a.join</code></pre>

<p><em>produces:</em></p>

<pre><code>a
Got here
c</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-run_source')" id="l_method-i-run_source">show</a>
                
              </p>
              <div id="method-i-run_source" class="dyn-source">
                <pre>VALUE
rb_thread_run(VALUE thread)
{
    rb_thread_wakeup(thread);
    rb_thread_schedule();
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-safe_level">
            
              <b>thr.safe_level   &rarr; integer
</b>
            
            <a href="../classes/Thread.html#method-i-safe_level" name="method-i-safe_level" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the safe level in effect for <em>thr</em>. Setting thread-local
safe levels can help when implementing sandboxes which run insecure code.</p>

<pre><code>thr = Thread.new { $SAFE = 3; sleep }
Thread.current.safe_level   #=&gt; 0
thr.safe_level              #=&gt; 3
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-safe_level_source')" id="l_method-i-safe_level_source">show</a>
                
              </p>
              <div id="method-i-safe_level_source" class="dyn-source">
                <pre>static VALUE
rb_thread_safe_level(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    return INT2NUM(th-&gt;safe_level);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-set_trace_func">
            
              <b>thr.set_trace_func(proc)    &rarr; proc
thr.set_trace_func(nil)     &rarr; nil
</b>
            
            <a href="../classes/Thread.html#method-i-set_trace_func" name="method-i-set_trace_func" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Establishes <em>proc</em> on <em>thr</em> as the handler for tracing, or
disables tracing if the parameter is <code>nil</code>. See
<code>set_trace_func</code>.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-set_trace_func_source')" id="l_method-i-set_trace_func_source">show</a>
                
              </p>
              <div id="method-i-set_trace_func_source" class="dyn-source">
                <pre>static VALUE
thread_set_trace_func_m(VALUE obj, VALUE trace)
{
    rb_thread_t *th;

    rb_secure(4);
    GetThreadPtr(obj, th);
    rb_threadptr_remove_event_hook(th, call_trace_func, Qundef);

    if (NIL_P(trace)) {
        return Qnil;
    }

    thread_add_trace_func(th, trace);
    return trace;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-status">
            
              <b>thr.status   &rarr; string, false or nil
</b>
            
            <a href="../classes/Thread.html#method-i-status" name="method-i-status" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the status of <em>thr</em>: “<code>sleep</code>&#39;&#39; if
<em>thr</em> is sleeping or waiting on I/O, “<code>run</code>&#39;&#39; if
<em>thr</em> is executing, “<code>aborting</code>&#39;&#39; if <em>thr</em>
is aborting, <code>false</code> if <em>thr</em> terminated normally, and
<code>nil</code> if <em>thr</em> terminated with an exception.</p>

<pre><code>a = Thread.new { raise(&quot;die now&quot;) }
b = Thread.new { Thread.stop }
c = Thread.new { Thread.exit }
d = Thread.new { sleep }
d.kill                  #=&gt; #&lt;Thread:0x401b3678 aborting&gt;
a.status                #=&gt; nil
b.status                #=&gt; &quot;sleep&quot;
c.status                #=&gt; false
d.status                #=&gt; &quot;aborting&quot;
Thread.current.status   #=&gt; &quot;run&quot;
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-status_source')" id="l_method-i-status_source">show</a>
                
              </p>
              <div id="method-i-status_source" class="dyn-source">
                <pre>static VALUE
rb_thread_status(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th)) {
        if (!NIL_P(th-&gt;errinfo) &amp;&amp; !FIXNUM_P(th-&gt;errinfo)
            /* TODO */ ) {
            return Qnil;
        }
        return Qfalse;
    }
    return rb_str_new2(thread_status_name(th));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-stop-3F">
            
              <b>thr.stop?   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-stop-3F" name="method-i-stop-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns <code>true</code> if <em>thr</em> is dead or sleeping.</p>

<pre><code>a = Thread.new { Thread.stop }
b = Thread.current
a.stop?   #=&gt; true
b.stop?   #=&gt; false
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-stop-3F_source')" id="l_method-i-stop-3F_source">show</a>
                
              </p>
              <div id="method-i-stop-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_stop_p(VALUE thread)
{
    rb_thread_t *th;
    GetThreadPtr(thread, th);

    if (rb_threadptr_dead(th))
        return Qtrue;
    if (th-&gt;status == THREAD_STOPPED || th-&gt;status == THREAD_STOPPED_FOREVER)
        return Qtrue;
    return Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-terminate">
            
              <b>thr.terminate   &rarr; thr or nil</b>
            
            <a href="../classes/Thread.html#method-i-terminate" name="method-i-terminate" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Terminates <em>thr</em> and schedules another thread to be run. If this
thread is already marked to be killed, <code>exit</code> returns the
<code>Thread</code>. If this is the main thread, or the last thread, exits
the process.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-terminate_source')" id="l_method-i-terminate_source">show</a>
                
              </p>
              <div id="method-i-terminate_source" class="dyn-source">
                <pre>VALUE
rb_thread_kill(VALUE thread)
{
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (th != GET_THREAD() &amp;&amp; th-&gt;safe_level &lt; 4) {
        rb_secure(4);
    }
    if (th-&gt;to_kill || th-&gt;status == THREAD_KILLED) {
        return thread;
    }
    if (th == th-&gt;vm-&gt;main_thread) {
        rb_exit(EXIT_SUCCESS);
    }

    thread_debug(&quot;rb_thread_kill: %p (%p)\n&quot;, (void *)th, (void *)th-&gt;thread_id);

    if (th == GET_THREAD()) {
        /* kill myself immediately */
        rb_threadptr_to_kill(th);
    }
    else {
        rb_threadptr_pending_interrupt_enque(th, eKillSignal);
        rb_threadptr_interrupt(th);
    }
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-thread_variable-3F">
            
              <b>thr.thread_variable?(key)   &rarr; true or false
</b>
            
            <a href="../classes/Thread.html#method-i-thread_variable-3F" name="method-i-thread_variable-3F" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns <code>true</code> if the given string (or symbol) exists as a
thread-local variable.</p>

<pre><code>me = Thread.current
me.thread_variable_set(:oliver, &quot;a&quot;)
me.thread_variable?(:oliver)    #=&gt; true
me.thread_variable?(:stanley)   #=&gt; false
</code></pre>

<p>Note that these are not fiber local variables.  Please see <a
href="Thread.html#method-i-5B-5D">#[]</a> and <a
href="Thread.html#method-i-thread_variable_get">#thread_variable_get</a>
for more details.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-thread_variable-3F_source')" id="l_method-i-thread_variable-3F_source">show</a>
                
              </p>
              <div id="method-i-thread_variable-3F_source" class="dyn-source">
                <pre>static VALUE
rb_thread_variable_p(VALUE thread, VALUE key)
{
    VALUE locals;

    locals = rb_iv_get(thread, &quot;locals&quot;);

    if (!RHASH(locals)-&gt;ntbl)
        return Qfalse;

    if (st_lookup(RHASH(locals)-&gt;ntbl, ID2SYM(rb_to_id(key)), 0)) {
        return Qtrue;
    }

    return Qfalse;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-thread_variable_get">
            
              <b>thr.thread_variable_get(key)  &rarr; obj or nil
</b>
            
            <a href="../classes/Thread.html#method-i-thread_variable_get" name="method-i-thread_variable_get" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns the value of a thread local variable that has been set.  Note that
these are different than fiber local values.  For fiber local values,
please see <a href="Thread.html#method-i-5B-5D">#[]</a> and <a
href="Thread.html#method-i-5B-5D-3D">#[]=</a>.</p>

<p><a href="Thread.html">Thread</a> local values are carried along with
threads, and do not respect fibers.  For example:</p>

<pre><code>Thread.new {
  Thread.current.thread_variable_set(&quot;foo&quot;, &quot;bar&quot;) # set a thread local
  Thread.current[&quot;foo&quot;] = &quot;bar&quot;                    # set a fiber local

  Fiber.new {
    Fiber.yield [
      Thread.current.thread_variable_get(&quot;foo&quot;), # get the thread local
      Thread.current[&quot;foo&quot;],                     # get the fiber local
    ]
  }.resume
}.join.value # =&gt; [&#39;bar&#39;, nil]
</code></pre>

<p>The value “bar” is returned for the thread local, where nil is returned for
the fiber local.  The fiber is executed in the same thread, so the thread
local values are available.</p>

<p>See also <a href="Thread.html#method-i-5B-5D">#[]</a></p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-thread_variable_get_source')" id="l_method-i-thread_variable_get_source">show</a>
                
              </p>
              <div id="method-i-thread_variable_get_source" class="dyn-source">
                <pre>static VALUE
rb_thread_variable_get(VALUE thread, VALUE id)
{
    VALUE locals;
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (rb_safe_level() &gt;= 4 &amp;&amp; th != GET_THREAD()) {
        rb_raise(rb_eSecurityError, &quot;Insecure: can&#39;t modify thread locals&quot;);
    }

    locals = rb_iv_get(thread, &quot;locals&quot;);
    return rb_hash_aref(locals, ID2SYM(rb_to_id(id)));
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-thread_variable_set">
            
              <b>thr.thread_variable_set(key, value)
</b>
            
            <a href="../classes/Thread.html#method-i-thread_variable_set" name="method-i-thread_variable_set" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Sets a thread local with <code>key</code> to <code>value</code>.  Note that
these are local to threads, and not to fibers.  Please see <a
href="Thread.html#method-i-thread_variable_get">#thread_variable_get</a>
and <a href="Thread.html#method-i-5B-5D">#[]</a> for more information.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-thread_variable_set_source')" id="l_method-i-thread_variable_set_source">show</a>
                
              </p>
              <div id="method-i-thread_variable_set_source" class="dyn-source">
                <pre>static VALUE
rb_thread_variable_set(VALUE thread, VALUE id, VALUE val)
{
    VALUE locals;
    rb_thread_t *th;

    GetThreadPtr(thread, th);

    if (rb_safe_level() &gt;= 4 &amp;&amp; th != GET_THREAD()) {
        rb_raise(rb_eSecurityError, &quot;Insecure: can&#39;t modify thread locals&quot;);
    }
    if (OBJ_FROZEN(thread)) {
        rb_error_frozen(&quot;thread locals&quot;);
    }

    locals = rb_iv_get(thread, &quot;locals&quot;);
    return rb_hash_aset(locals, ID2SYM(rb_to_id(id)), val);
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-thread_variables">
            
              <b>thr.thread_variables   &rarr; array
</b>
            
            <a href="../classes/Thread.html#method-i-thread_variables" name="method-i-thread_variables" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Returns an an array of the names of the thread-local variables (as
Symbols).</p>

<pre><code>thr = Thread.new do
  Thread.current.thread_variable_set(:cat, &#39;meow&#39;)
  Thread.current.thread_variable_set(&quot;dog&quot;, &#39;woof&#39;)
end
thr.join               #=&gt; #&lt;Thread:0x401b3f10 dead&gt;
thr.thread_variables   #=&gt; [:dog, :cat]
</code></pre>

<p>Note that these are not fiber local variables.  Please see <a
href="Thread.html#method-i-5B-5D">#[]</a> and <a
href="Thread.html#method-i-thread_variable_get">#thread_variable_get</a>
for more details.</p>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-thread_variables_source')" id="l_method-i-thread_variables_source">show</a>
                
              </p>
              <div id="method-i-thread_variables_source" class="dyn-source">
                <pre>static VALUE
rb_thread_variables(VALUE thread)
{
    VALUE locals;
    VALUE ary;

    locals = rb_iv_get(thread, &quot;locals&quot;);
    ary = rb_ary_new();
    rb_hash_foreach(locals, keys_i, ary);

    return ary;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-value">
            
              <b>thr.value   &rarr; obj
</b>
            
            <a href="../classes/Thread.html#method-i-value" name="method-i-value" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Waits for <em>thr</em> to complete (via <code>Thread#join</code>) and
returns its value.</p>

<pre><code>a = Thread.new { 2 + 2 }
a.value   #=&gt; 4
</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-value_source')" id="l_method-i-value_source">show</a>
                
              </p>
              <div id="method-i-value_source" class="dyn-source">
                <pre>static VALUE
thread_value(VALUE self)
{
    rb_thread_t *th;
    GetThreadPtr(self, th);
    thread_join(th, DELAY_INFTY);
    return th-&gt;value;
}</pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-wakeup">
            
              <b>thr.wakeup   &rarr; thr
</b>
            
            <a href="../classes/Thread.html#method-i-wakeup" name="method-i-wakeup" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Marks <em>thr</em> as eligible for scheduling (it may still remain blocked
on I/O, however). Does not invoke the scheduler (see
<code>Thread#run</code>).</p>

<pre><code>c = Thread.new { Thread.stop; puts &quot;hey!&quot; }
sleep 0.1 while c.status!=&#39;sleep&#39;
c.wakeup
c.join</code></pre>

<p><em>produces:</em></p>

<pre><code>hey!</code></pre>
            </div>
          
          
          

          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-wakeup_source')" id="l_method-i-wakeup_source">show</a>
                
              </p>
              <div id="method-i-wakeup_source" class="dyn-source">
                <pre>VALUE
rb_thread_wakeup(VALUE thread)
{
    if (!RTEST(rb_thread_wakeup_alive(thread))) {
        rb_raise(rb_eThreadError, &quot;killed thread&quot;);
    }
    return thread;
}</pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    